<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Ranker</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .app { min-height: 100vh; background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); padding: 16px; }
    .container { max-width: 896px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 32px; padding-top: 32px; }
    .header h1 { font-size: 48px; font-weight: bold; color: white; margin-bottom: 8px; }
    .header p { color: #e9d5ff; font-size: 18px; }
    .card { background: white; border-radius: 16px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); padding: 32px; margin-bottom: 24px; }
    .object-header { text-align: center; margin-bottom: 32px; }
    .emoji { font-size: 60px; margin-bottom: 16px; }
    .object-name { font-size: 36px; font-weight: bold; color: #9333ea; margin-bottom: 8px; }
    .date { color: #6b7280; }
    .category { margin-bottom: 24px; }
    .category-label { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .category-name { font-size: 18px; font-weight: 600; color: #374151; }
    .category-value { font-size: 24px; font-weight: bold; color: #9333ea; }
    .slider { width: 100%; height: 12px; border-radius: 8px; outline: none; -webkit-appearance: none; cursor: pointer; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #9333ea; cursor: pointer; }
    .slider::-moz-range-thumb { width: 24px; height: 24px; border-radius: 50%; background: #9333ea; cursor: pointer; border: none; }
    .scale { display: flex; justify-content: space-between; font-size: 12px; color: #6b7280; margin-top: 4px; }
    .comment-label { font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 12px; display: block; }
    textarea { width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 8px; resize: none; font-family: inherit; font-size: 14px; }
    textarea:focus { outline: none; border-color: #9333ea; }
    .submit-btn { width: 100%; padding: 16px; background: linear-gradient(90deg, #a855f7 0%, #ec4899 100%); color: white; font-size: 18px; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
    .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; background: #9ca3af; }
    .voted { text-align: center; padding: 32px 0; }
    .voted .emoji { font-size: 60px; margin-bottom: 16px; }
    .voted-title { font-size: 20px; font-weight: 600; color: #374151; }
    .voted-subtitle { color: #6b7280; margin-top: 8px; }
    .rankings-title { font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 24px; }
    .ranking-item { display: flex; align-items: center; gap: 16px; padding: 16px; background: linear-gradient(90deg, #faf5ff 0%, #fce7f3 100%); border-radius: 8px; margin-bottom: 12px; }
    .rank { font-size: 24px; font-weight: bold; min-width: 50px; }
    .rank-1 { color: #eab308; }
    .rank-2 { color: #9ca3af; }
    .rank-3 { color: #ea580c; }
    .rank-other { color: #6b7280; }
    .item-info { flex: 1; }
    .item-name { font-weight: bold; font-size: 18px; color: #1f2937; }
    .item-meta { font-size: 14px; color: #6b7280; margin-top: 2px; }
    .score { font-size: 24px; font-weight: bold; color: #9333ea; }
    .loading { min-height: 100vh; background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; }
    .empty { text-align: center; color: #6b7280; padding: 32px 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script>
    const { useState, useEffect, createElement: e } = React;
    
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyDOz_C363nVZWo-Va5fSrC5IEOhm10eTyM",
      authDomain: "rankedbyratings.firebaseapp.com",
      databaseURL: "https://rankedbyratings-default-rtdb.firebaseio.com",
      projectId: "rankedbyratings",
      storageBucket: "rankedbyratings.firebasestorage.app",
      messagingSenderId: "1038168946432",
      appId: "1:1038168946432:web:0535ae3f1ff7e83dee65e5"
    };
    
    const CATEGORIES = ['Utility', 'Aesthetic', 'Cultural Impact', 'Versatility', 'Sustainability'];

    function DailyRanker() {
      const [currentObject, setCurrentObject] = useState('');
      const [ratings, setRatings] = useState({});
      const [comment, setComment] = useState('');
      const [hasVotedToday, setHasVotedToday] = useState(false);
      const [allRankings, setAllRankings] = useState([]);
      const [loading, setLoading] = useState(true);
      const [userId, setUserId] = useState('');

      const getTodayKey = () => {
        const today = new Date();
        return today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
      };

      const getUserId = () => {
        let id = localStorage.getItem('dailyRankerUserId');
        if (!id) {
          id = 'user_' + Math.random().toString(36).substr(2, 9) + Date.now();
          localStorage.setItem('dailyRankerUserId', id);
        }
        return id;
      };

      useEffect(() => {
        setUserId(getUserId());
        initializeFirebase();
      }, []);

      const initializeFirebase = async () => {
        try {
          if (firebase.apps.length === 0) {
            firebase.initializeApp(FIREBASE_CONFIG);
          }
          loadData();
        } catch (error) {
          console.error('Firebase error:', error);
          setLoading(false);
        }
      };

      const generateDailyObject = async (dateKey) => {
        try {
          const db = firebase.database();
          const todayObjectRef = db.ref('dailyObjects/' + dateKey);
          const snapshot = await todayObjectRef.once('value');
          
          if (snapshot.exists()) {
            return snapshot.val().noun;
          }
          
          const response = await fetch('https://random-word-api.herokuapp.com/word?number=1&type=noun');
          const words = await response.json();
          let noun = words[0];
          noun = noun.charAt(0).toUpperCase() + noun.slice(1);
          
          await todayObjectRef.set({ noun: noun, date: dateKey, timestamp: Date.now() });
          return noun;
        } catch (error) {
          console.error('Error:', error);
          const fallbackNouns = ['Umbrella', 'Book', 'Chair', 'Lamp', 'Clock'];
          const hash = dateKey.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
          return fallbackNouns[hash % fallbackNouns.length];
        }
      };

      const loadData = async () => {
        setLoading(true);
        const todayKey = getTodayKey();
        const objectForToday = await generateDailyObject(todayKey);
        setCurrentObject(objectForToday);

        try {
          const db = firebase.database();
          const userIdTemp = getUserId();
          const voteSnapshot = await db.ref('userVotes/' + userIdTemp + '/' + todayKey).once('value');
          setHasVotedToday(voteSnapshot.exists());

          const rankingsSnapshot = await db.ref('rankings').once('value');
          const rankingsData = rankingsSnapshot.val();
          
          if (rankingsData) {
            const rankingsArray = Object.values(rankingsData).sort((a, b) => b.avgRating - a.avgRating);
            setAllRankings(rankingsArray);
          }
        } catch (error) {
          console.error('Error:', error);
        }
        setLoading(false);
      };

      const handleRatingChange = (category, value) => {
        setRatings(prev => Object.assign({}, prev, { [category]: value }));
      };

      const handleSubmit = async () => {
        if (Object.keys(ratings).length !== CATEGORIES.length) {
          alert('Please rate all categories!');
          return;
        }

        const todayKey = getTodayKey();
        
        try {
          const db = firebase.database();
          const objectRef = db.ref('objects/' + currentObject);
          const objectSnapshot = await objectRef.once('value');
          
          let objectData = objectSnapshot.val() || {
            name: currentObject, date: todayKey, totalVotes: 0, categoryTotals: {}
          };

          const voteId = db.ref().child('votes').push().key;
          await db.ref('votes/' + currentObject + '/' + voteId).set({
            userId: userId, ratings: ratings, comment: comment.trim(), timestamp: Date.now()
          });

          objectData.totalVotes += 1;
          CATEGORIES.forEach(cat => {
            if (!objectData.categoryTotals[cat]) objectData.categoryTotals[cat] = 0;
            objectData.categoryTotals[cat] += ratings[cat];
          });

          const overallTotal = Object.values(objectData.categoryTotals).reduce((a, b) => a + b, 0);
          const avgRating = overallTotal / (CATEGORIES.length * objectData.totalVotes);
          objectData.avgRating = avgRating;

          await objectRef.set(objectData);
          await db.ref('rankings/' + currentObject).set({
            name: currentObject, date: todayKey, avgRating: avgRating, totalVotes: objectData.totalVotes
          });

          await db.ref('userVotes/' + userId + '/' + todayKey).set(true);
          await loadData();
          
          setRatings({});
          setComment('');
        } catch (error) {
          console.error('Error:', error);
          alert('Error saving vote!');
        }
      };

      if (loading) {
        return e('div', { className: 'loading' }, 'Loading...');
      }

      return e('div', { className: 'app' },
        e('div', { className: 'container' }, [
          e('div', { key: 'header', className: 'header' }, [
            e('h1', { key: 'title' }, 'Daily Ranker'),
            e('p', { key: 'subtitle' }, 'Rate today\'s random object with the community')
          ]),
          
          e('div', { key: 'voting', className: 'card' }, [
            e('div', { key: 'object-header', className: 'object-header' }, [
              e('div', { key: 'emoji', className: 'emoji' }, 'ðŸ“¦'),
              e('h3', { key: 'name', className: 'object-name' }, currentObject),
              e('p', { key: 'date', className: 'date' }, getTodayKey())
            ]),
            
            !hasVotedToday ? e('div', { key: 'form' }, [
              e('div', { key: 'categories' },
                CATEGORIES.map((category, idx) => 
                  e('div', { key: category, className: 'category' }, [
                    e('div', { key: 'label', className: 'category-label' }, [
                      e('span', { key: 'name', className: 'category-name' }, category),
                      e('span', { key: 'value', className: 'category-value' }, ratings[category] || 0)
                    ]),
                    e('input', {
                      key: 'slider',
                      type: 'range',
                      min: 0,
                      max: 100,
                      value: ratings[category] || 0,
                      onChange: (ev) => handleRatingChange(category, parseInt(ev.target.value)),
                      className: 'slider',
                      style: { background: 'linear-gradient(to right, #a855f7 0%, #a855f7 ' + (ratings[category] || 0) + '%, #e5e7eb ' + (ratings[category] || 0) + '%, #e5e7eb 100%)' }
                    }),
                    e('div', { key: 'scale', className: 'scale' }, [
                      e('span', { key: '0' }, '0'),
                      e('span', { key: '50' }, '50'),
                      e('span', { key: '100' }, '100')
                    ])
                  ])
                )
              ),
              e('label', { key: 'comment-label', className: 'comment-label' }, 'Comment (Optional)'),
              e('textarea', {
                key: 'comment',
                value: comment,
                onChange: (ev) => setComment(ev.target.value),
                placeholder: 'Share your thoughts...',
                rows: 3
              }),
              e('button', {
                key: 'submit',
                onClick: handleSubmit,
                disabled: Object.keys(ratings).length !== CATEGORIES.length,
                className: 'submit-btn',
                style: { marginTop: '24px' }
              }, 'Submit Ratings')
            ]) : e('div', { key: 'voted', className: 'voted' }, [
              e('div', { key: 'emoji', className: 'emoji' }, 'âœ…'),
              e('p', { key: 'title', className: 'voted-title' }, 'You\'ve voted today!'),
              e('p', { key: 'subtitle', className: 'voted-subtitle' }, 'Come back tomorrow for a new object')
            ])
          ]),
          
          e('div', { key: 'rankings', className: 'card' }, [
            e('h2', { key: 'title', className: 'rankings-title' }, 'All-Time Rankings'),
            allRankings.length === 0 ? 
              e('p', { key: 'empty', className: 'empty' }, 'No rankings yet. Be the first to vote!') :
              e('div', { key: 'list' },
                allRankings.map((item, index) =>
                  e('div', { key: item.name, className: 'ranking-item' }, [
                    e('div', { 
                      key: 'rank',
                      className: 'rank ' + (index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other')
                    }, '#' + (index + 1)),
                    e('div', { key: 'info', className: 'item-info' }, [
                      e('div', { key: 'name', className: 'item-name' }, item.name),
                      e('div', { key: 'meta', className: 'item-meta' }, item.totalVotes + ' votes â€¢ ' + item.date)
                    ]),
                    e('span', { key: 'score', className: 'score' }, item.avgRating.toFixed(1))
                  ])
                )
              )
          ])
        ])
      );
    }

    ReactDOM.render(e(DailyRanker), document.getElementById('root'));
  </script>
</body>
</html>



